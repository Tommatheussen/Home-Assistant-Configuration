platform: template
sensors:
  lights_on:
    friendly_name: "Amount of lights currently on"
    value_template: >
      {% set lights = [
        states.light.door,
        states.light.living_room_wall,
        states.light.mirror,
        states.light.nighthall_wall,
        states.light.shower,
        states.light.toilet_downstairs,
        states.light.toilet_upstairs,
        states.light.office,
        states.light.hallway,
        states.light.entrance,
        states.light.dining_room,
        states.light.living_room,
        states.light.kitchen_living_room,
        states.light.kitchen_window,
        states.light.storage_room_middle,
        states.light.storage_room_door,
        states.light.bedroom_parents,
        states.light.bathroom,
        states.light.nighthall_ceiling
      ] %}
      {{ lights | selectattr('state','eq','on') | list | count }}
  
  daily_back_to_net:
    unit_of_measurement: kWh
    value_template: >-
      {{ states('sensor.daily_production_high') | float + states('sensor.daily_production_low') | float }}

  daily_from_net:
    unit_of_measurement: kWh
    value_template: >-
      {{ states('sensor.daily_consumption_high') | float + states('sensor.daily_consumption_low') | float }}

  daily_netto_verbruik:
    unit_of_measurement: kWh
    value_template: >-
      {{ states('sensor.daily_from_net') | float - states('sensor.daily_back_to_net') | float }}

  dagelijks_verbruik:
    unit_of_measurement: kWh
    value_template: >-
      {{ ((states('sensor.daily_yield') | float) / 1000) -
        states('sensor.daily_back_to_net') | float + 
        states('sensor.daily_from_net') | float
      }}

  zelfverbruik:
    unit_of_measurement: kWh
    value_template: >-
      {{ ((states('sensor.daily_yield') | float) / 1000) - states('sensor.daily_back_to_net') | float }}
  
  zelfverbruik_percentage:
    unit_of_measurement: '%'
    value_template: >-
      {% set t = states('sensor.daily_yield') | float / 1000 %}
      {% set u = states('sensor.daily_back_to_net') | float %}
      {{ ((t - u) / t) * 100 }}